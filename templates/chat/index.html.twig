{% extends 'base.html.twig' %}

{% block title %}Support Chat - Quernel Auto{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/chat.css') }}">
{% endblock %}

{% block body %}
<article class="chat-container">
    <header class="chat-header">
        <div class="chat-header-info">
            <h1><i class="fas fa-comments"></i> Support Chat</h1>
            <p>Nos administrateurs sont là pour vous aider</p>
        </div>
        <div class="chat-status">
            <span class="status-indicator online"></span>
            <span class="status-text">En ligne</span>
        </div>
    </header>

    <div class="chat-messages" id="chatMessages">
        {% if messages is empty %}
            <div class="welcome-message">
                <div class="welcome-icon">
                    <i class="fas fa-hand-wave"></i>
                </div>
                <h3>Bienvenue !</h3>
                <p>Comment pouvons-nous vous aider aujourd'hui ?</p>
                <p class="welcome-note">Un administrateur vous répondra dans les plus brefs délais.</p>
            </div>
        {% else %}
            {% for message in messages %}
                <article class="message {{ message.isFromUser ? 'message-user' : 'message-admin' }}">
                    <div class="message-content">
                        <p class="message-text">{{ message.content }}</p>
                        <time class="message-time" datetime="{{ message.sendAt|date('c') }}">{{ message.sendAt|date('H:i') }}</time>
                    </div>
                    <footer class="message-sender">
                        {% if message.isFromUser %}
                            <i class="fas fa-user"></i> Vous
                        {% else %}
                            <i class="fas fa-headset"></i> Support
                        {% endif %}
                    </footer>
                </article>
            {% endfor %}
        {% endif %}
    </div>

    <footer class="chat-input-container">
        <form id="chatForm" 
              class="chat-form"
              data-send-url="{{ path('app_chat_send') }}"
              data-get-messages-url="{{ path('app_chat_get_messages', {'conversationId': conversationId}) }}"
              data-conversation-id="{{ conversationId }}">
            <div class="input-group">
                <textarea 
                    id="messageInput" 
                    class="chat-input" 
                    placeholder="Tapez votre message..."
                    rows="1"
                    maxlength="255"
                ></textarea>
                <button type="submit" class="send-button" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="input-footer">
                <span class="char-count" id="charCount">0/255</span>
            </div>
        </form>
    </footer>
</article>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/chat.js') }}" defer></script>
{% endblock %} 